var TYPE_PROMPT_theTextBox;var TYPE_PROMPT_objLastActive;var TYPE_PROMPT_selectSpanTitleStart="<span style='width:100%;display:block;' class='spanOutputTitleElement'>";var TYPE_PROMPT_selectSpanStart="<span style='width:100%;display:block;' class='spanOutputNormalElement' onmouseover='setTypePromptHighColor(this)' ";var TYPE_PROMPT_selectSpanEnd="</span>";function initializeTypePromptProperties(a,b){if(a.typePromptObj==null){var c={elem:a,paramsObj:null,currentRecordCount:0,spanOutputId:"",timer:false,resultItemsXmlRoot:null,resultItemsCount:0,strLastValue:"",bMadeRequest:false,currentValueSelected:-1,bNoResults:false};if(a.id){c.spanOutputId="spanOutput_"+a.id}else{c.spanOutputId="spanOutput_"+a.name}b=paramdecode(b);c.paramsObj=eval("("+b+")");var d=document.getElementById(c.spanOutputId);if(d==null){var e=document.createElement("span");e.id=c.spanOutputId;e.className="spanOutputTextTypePrompt";document.body.appendChild(e)}if(c.paramsObj.spanOutputWidth==null||c.paramsObj.spanOutputWidth<=0){c.paramsObj.spanOutputWidth=a.offsetWidth}if(c.paramsObj.resultCount==null||c.paramsObj.resultCount<=0){c.paramsObj.resultCount=15}a.onkeyup=doKeyUpEvent;a.onkeydown=doKeyDownEvent;a.typePromptObj=c}if(a.typePromptObj.paramsObj.isSelectBox===true){getTypeAheadDataOnFocus(a)}}function getTypeAheadDataOnFocus(c){TYPE_PROMPT_theTextBox=c;TYPE_PROMPT_objLastActive=TYPE_PROMPT_theTextBox;TYPE_PROMPT_theTextBox.typePromptObj.bMadeRequest=true;var d=TYPE_PROMPT_theTextBox.value;if(d==TYPE_PROMPT_theTextBox.typePromptObj.paramsObj.conditionlabel){d=""}getTypeAheadData(d);TYPE_PROMPT_theTextBox.typePromptObj.strLastValue=d}function doKeyDownEvent(f){var d;var e;if(window.event){d=window.event;e=window.event.keyCode}else{d=f;e=f.which}if(TYPE_PROMPT_objLastActive==TYPE_PROMPT_theTextBox){if(e==38){moveTypePromptHighlight(-1)}else{if(e==40){moveTypePromptHighlight(1)}else{if(e==27){TYPE_PROMPT_theTextBox.typePromptObj.currentValueSelected=-1;hideTypePromptTheBox(TYPE_PROMPT_theTextBox);TYPE_PROMPT_theTextBox.value=TYPE_PROMPT_theTextBox.typePromptObj.strLastValue}else{if(e==13){grabTypePromptHighlighted();TYPE_PROMPT_theTextBox.blur();d.returnValue=false;if(d.preventDefault){d.preventDefault()}}}}}}}function doKeyUpEvent(c){var d=-1;if(window.event){d=window.event.keyCode;TYPE_PROMPT_theTextBox=window.event.srcElement}else{d=c.which;TYPE_PROMPT_theTextBox=c.target}if(TYPE_PROMPT_theTextBox.typePromptObj.paramsObj.timeoutSecond>0){if(TYPE_PROMPT_theTextBox.typePromptObj.timer){eraseTypePromptTimeout()}startTypePromptTimeout()}if(TYPE_PROMPT_theTextBox.value.length==0&&TYPE_PROMPT_theTextBox.typePromptObj.paramsObj.isSelectBox!==true){TYPE_PROMPT_theTextBox.typePromptObj.resultItemsXmlRoot=null;hideTypePromptTheBox(TYPE_PROMPT_theTextBox);TYPE_PROMPT_theTextBox.typePromptObj.strLastValue="";return false}if(TYPE_PROMPT_objLastActive==TYPE_PROMPT_theTextBox){if((d<32&&d!=8)||(d>=33&&d<46)||(d>=112&&d<=123)){return false}}if(TYPE_PROMPT_objLastActive!=TYPE_PROMPT_theTextBox||TYPE_PROMPT_theTextBox.value.indexOf(TYPE_PROMPT_theTextBox.typePromptObj.strLastValue)!=0||((TYPE_PROMPT_theTextBox.typePromptObj.resultItemsCount==0||TYPE_PROMPT_theTextBox.typePromptObj.resultItemsCount==TYPE_PROMPT_theTextBox.typePromptObj.paramsObj.resultCount)&&!TYPE_PROMPT_theTextBox.typePromptObj.bNoResults)||TYPE_PROMPT_theTextBox.value.length<TYPE_PROMPT_theTextBox.typePromptObj.strLastValue.length||TYPE_PROMPT_theTextBox.typePromptObj.strLastValue==""){TYPE_PROMPT_objLastActive=TYPE_PROMPT_theTextBox;TYPE_PROMPT_theTextBox.typePromptObj.bMadeRequest=true;getTypeAheadData(TYPE_PROMPT_theTextBox.value)}else{if(!TYPE_PROMPT_theTextBox.typePromptObj.bMadeRequest){buildTypeAheadBox(TYPE_PROMPT_theTextBox.value)}}TYPE_PROMPT_theTextBox.typePromptObj.strLastValue=TYPE_PROMPT_theTextBox.value}function getTypeAheadData(k){if((k==null||k=="")&&TYPE_PROMPT_theTextBox.typePromptObj.paramsObj.isSelectBox!==true){return}if(k==null){k=""}var j=TYPE_PROMPT_theTextBox.typePromptObj.paramsObj.pageid;var o=TYPE_PROMPT_theTextBox.typePromptObj.paramsObj.reportid;var m=TYPE_PROMPT_theTextBox.typePromptObj.paramsObj.inputboxid;var p=getComponentGuidById(j,o);var i=getReportMetadataObj(p);var n=getComponentUrl(j,i.refreshComponentGuid,i.slave_reportid);n=replaceUrlParamValue(n,"REPORTID",o);n=replaceUrlParamValue(n,"INPUTBOXID",m);n=replaceUrlParamValue(n,"ACTIONTYPE","GetTypePromptDataList");n=replaceUrlParamValue(n,"TYPE_PROMPT_TXTVALUE",k);var l=n.substring(n.indexOf("?")+1);n=n.substring(0,n.indexOf("?"));XMLHttpREPORT.sendReq("POST",n,l,buildChoices,onErrorMethodTypeAhead,null)}function buildChoices(f,d){var e=f.responseXML;TYPE_PROMPT_theTextBox.typePromptObj.resultItemsXmlRoot=e.getElementsByTagName("items")[0];if(TYPE_PROMPT_theTextBox.typePromptObj.resultItemsXmlRoot!=null){TYPE_PROMPT_theTextBox.typePromptObj.resultItemsCount=TYPE_PROMPT_theTextBox.typePromptObj.resultItemsXmlRoot.childNodes.length}else{TYPE_PROMPT_theTextBox.typePromptObj.resultItemsCount=0}TYPE_PROMPT_theTextBox.typePromptObj.bMadeRequest=false;buildTypeAheadBox(TYPE_PROMPT_theTextBox.typePromptObj.strLastValue)}function onErrorMethodTypeAhead(b){TYPE_PROMPT_theTextBox.typePromptObj.bMadeRequest=false;window.status="ERROR：从服务器端取输入前提示信息失败"}function buildTypeAheadBox(j){var l=makeMatches(j);if(l.length>0){var k=document;setTypePromptOutputSpanPosition(TYPE_PROMPT_theTextBox);var g=k.getElementById(TYPE_PROMPT_theTextBox.typePromptObj.spanOutputId);g.innerHTML=l;var h=k.getElementById(TYPE_PROMPT_theTextBox.typePromptObj.spanOutputId+"_inner");if(h!=null){var i=TYPE_PROMPT_theTextBox.typePromptObj.paramsObj.spanOutputMaxheight;if(i==null||i<15){i=350}if(h.offsetHeight<i-10){g.style.height=(h.offsetHeight+10)+"px"}else{g.style.height=i+"px"}}k.getElementById(TYPE_PROMPT_theTextBox.typePromptObj.spanOutputId+"_0").className="spanOutputHighElement";TYPE_PROMPT_theTextBox.typePromptObj.currentValueSelected=0;TYPE_PROMPT_theTextBox.typePromptObj.bNoResults=false;EventTools.addEventHandler(window.document,"mousedown",hideTypePromptTheBoxEvent)}else{TYPE_PROMPT_theTextBox.typePromptObj.currentValueSelected=-1;TYPE_PROMPT_theTextBox.typePromptObj.bNoResults=true;hideTypePromptTheBox(TYPE_PROMPT_theTextBox)}}function hideTypePromptTheBoxEvent(c){var d=window.event?window.event.srcElement:c.target;if(d!=null){if(d.getAttribute("id")==TYPE_PROMPT_theTextBox.getAttribute("id")){return}if(isElementOrChildElement(d,TYPE_PROMPT_theTextBox.typePromptObj.spanOutputId)){return}}hideTypePromptTheBox(TYPE_PROMPT_theTextBox)}function setTypePromptOutputSpanPosition(e){var f=getElementAbsolutePosition(e);var d=document.getElementById(e.typePromptObj.spanOutputId);d.style.left=f.left+"px";d.style.width=parseInt(e.typePromptObj.paramsObj.spanOutputWidth)+"px";d.style.top=(f.top+f.height)+"px";d.style.display="block";if(e.typePromptObj.paramsObj.timeoutSecond>0){d.onmouseout=startTypePromptTimeout;d.onmouseover=eraseTypePromptTimeout}else{d.onmouseout=null;d.onmouseover=null}}function makeMatches(L){TYPE_PROMPT_theTextBox.typePromptObj.currentRecordCount=0;if(TYPE_PROMPT_theTextBox.typePromptObj.resultItemsXmlRoot==null){return""}if(TYPE_PROMPT_theTextBox.typePromptObj.resultItemsCount==0){return""}var O="";var N=TYPE_PROMPT_theTextBox.typePromptObj.paramsObj.colsArray;var R=0;for(var z=0,y=N.length;z<y;z++){if(N[z].hidden!==true){R++}}if(R==0){return""}if(TYPE_PROMPT_theTextBox.typePromptObj.paramsObj.isShowTitle){O=TYPE_PROMPT_selectSpanTitleStart;for(var z=0,y=N.length;z<y;z=z+1){if(N[z].hidden!==true){O=O+"<span style='width:"+99/R+"%;display:inline-block;'>"+N[z].coltitle+"</span>"}}O=O+TYPE_PROMPT_selectSpanEnd}if(L==null){L=""}var I=TYPE_PROMPT_theTextBox.typePromptObj.paramsObj.isSelectBox;var B=TYPE_PROMPT_theTextBox.typePromptObj.paramsObj.isCasesensitive;if(B!==true){L=L.toLowerCase()}var D=TYPE_PROMPT_theTextBox.typePromptObj.paramsObj.clientMatchMethod;var J=TYPE_PROMPT_theTextBox.typePromptObj.resultItemsXmlRoot.childNodes;for(var z=0,y=J.length;z<y;z=z+1){var j=J.item(z);var G=j.attributes;var C="";var i="";for(var A=0,M=N.length;A<M;A=A+1){var F=N[A].matchmode;if(F==null||F==""){F="0"}var Q=G.getNamedItem(N[A].collabel).value;if(N[A].hidden!==true){if(L!=""&&D==null){Q=formatMatchText(Q,L,parseInt(F),B)}C=C+"<span style='width:"+99/R+"%;display:inline-block;'>"+Q+"</span>"}i+=Q;if(N[A].colvalue!=null){i+=";;;"+G.getNamedItem(N[A].colvalue).value}i+="|||"}if(i.indexOf(i.length-3,i.length)=="|||"){i=i.substring(0,i.length-3)}for(var A=0,M=N.length;A<M;A=A+1){var F=N[A].matchmode;if(F==null||F==""){continue}var H=parseInt(F);if(H<=0){continue}var K=G.getNamedItem(N[A].collabel).value;var E=G.getNamedItem(N[A].colvalue).value;if(K==null){K=""}if(B!==true){K=K.toLowerCase()}if(L==""&&I===true||D==null&&defaultMatcherMethod(K,L,H)||D!=null&&D(K,L,H)){var P=' colparamvalues="'+i+'" onmousedown="setTypePromptText(\''+E+"',this)\" id='"+TYPE_PROMPT_theTextBox.typePromptObj.spanOutputId+"_"+TYPE_PROMPT_theTextBox.typePromptObj.currentRecordCount+"' value='"+E+"'>"+C;O+=TYPE_PROMPT_selectSpanStart+P+TYPE_PROMPT_selectSpanEnd;TYPE_PROMPT_theTextBox.typePromptObj.currentRecordCount++;break}}}if(TYPE_PROMPT_theTextBox.typePromptObj.currentRecordCount<=0){return""}O="<div id='"+TYPE_PROMPT_theTextBox.typePromptObj.spanOutputId+"_inner'>"+O+"</div>";return O}function defaultMatcherMethod(d,e,f){return(f==1&&d.indexOf(e)==0)||(f==2&&d.indexOf(e)>=0)}function formatMatchText(h,k,l,m){if(l!=1&&l!=2){return h}var i=null;if(l==1&&h.indexOf(k)==0){if(m==true){i=new RegExp("^"+k)}else{i=new RegExp("^"+k,"i")}}else{if(l==2&&h.indexOf(k)>=0){if(m==true){i=new RegExp(k)}else{i=new RegExp(k,"i")}}}if(i==null){return h}var n="";var j=splitTextValues(h,i,k.length);while(j!=null){n=n+j.start+"<u>"+j.mid+"</u>";h=j.end;j=splitTextValues(h,i,k.length)}n=n+h;return n}function moveTypePromptHighlight(b){if(TYPE_PROMPT_theTextBox.typePromptObj.currentValueSelected>=0){newValue=parseInt(TYPE_PROMPT_theTextBox.typePromptObj.currentValueSelected)+parseInt(b);if(newValue==TYPE_PROMPT_theTextBox.typePromptObj.currentRecordCount){newValue=0}if(newValue<0){newValue=TYPE_PROMPT_theTextBox.typePromptObj.currentRecordCount-1}TYPE_PROMPT_theTextBox.typePromptObj.currentValueSelected=newValue;setTypePromptHighColor(null)}}function setTypePromptText(t,s){var l=s.getAttribute("colparamvalues");var m=new Array();if(l!=null&&l!=""){var n=l.split("|||");var i;for(var q=0,p=n.length;q<p;q++){if(n[q]==null||n[q]==""){continue}i=new Object();var o=n[q].indexOf(";;;");if(o>0){i.label=n[q].substring(0,o);i.value=n[q].substring(o+3)}else{i.label=n[q];i.value=null}m[m.length]=i}}TYPE_PROMPT_theTextBox.value=t;hideTypePromptTheBox(TYPE_PROMPT_theTextBox);var r=TYPE_PROMPT_theTextBox.typePromptObj.paramsObj.callbackmethod;if(r!=null){r(TYPE_PROMPT_theTextBox,m)}}function setTypePromptHighColor(e){if(e){var g=e.id.split("_");TYPE_PROMPT_theTextBox.typePromptObj.currentValueSelected=g[g.length-1]}for(var h=0;h<TYPE_PROMPT_theTextBox.typePromptObj.currentRecordCount;h++){document.getElementById(TYPE_PROMPT_theTextBox.typePromptObj.spanOutputId+"_"+h).className="spanOutputNormalElement"}var f=document.getElementById(TYPE_PROMPT_theTextBox.typePromptObj.spanOutputId+"_"+TYPE_PROMPT_theTextBox.typePromptObj.currentValueSelected);if(f){f.className="spanOutputHighElement"}}function grabTypePromptHighlighted(){if(TYPE_PROMPT_theTextBox.typePromptObj.currentValueSelected>=0){var d=document.getElementById(TYPE_PROMPT_theTextBox.typePromptObj.spanOutputId+"_"+TYPE_PROMPT_theTextBox.typePromptObj.currentValueSelected);if(d){var c=d.getAttribute("value");setTypePromptText(c,d)}}}function hideTypePromptTheBox(b){document.getElementById(b.typePromptObj.spanOutputId).style.display="none";b.typePromptObj.currentValueSelected=-1;b.typePromptObj.bNoResults=false;clearTimeout(b.typePromptObj.timer);b.typePromptObj.timer=false;EventTools.removeEventHandler(window.document,"mousedown",hideTypePromptTheBoxEvent)}function startTypePromptTimeout(){TYPE_PROMPT_theTextBox.typePromptObj.timer=setTimeout(function(){hideTypePromptTheBox(TYPE_PROMPT_theTextBox)},TYPE_PROMPT_theTextBox.typePromptObj.paramsObj.timeoutSecond*1000)}function eraseTypePromptTimeout(){clearTimeout(TYPE_PROMPT_theTextBox.typePromptObj.timer);TYPE_PROMPT_theTextBox.typePromptObj.timer=false}var WX_TYPEPROMPT_LOADED=true;